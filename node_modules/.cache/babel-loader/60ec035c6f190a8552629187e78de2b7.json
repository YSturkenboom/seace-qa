{"ast":null,"code":"var _jsxFileName=\"/home/yuri/Freelance/Clients/Cheil/seace-qa/src/MapScreen.tsx\";/// @ts-nocheck\nimport React,{useState,useEffect,Fragment}from'react';import'./MapScreen.css';import{Filter}from'./components/MapFilter';import{MapLegend}from'./components/MapLegend';import{MapRegionIndicator}from'./components/MapRegionIndicator';import{withScriptjs,withGoogleMap,GoogleMap,Marker,InfoWindow}from\"react-google-maps\";const{GoogleSpreadsheet}=require('google-spreadsheet');const doc=new GoogleSpreadsheet('1QtCGUCN-_xZPLYExN3btHeXphRi4VI-uGABA87cHj-M');const REGION_TO_SHEET_MAP={'Spain':1,'Sweden':2,'Denmark':3,'Finland':4,'Italy':5,'Norway':6,'SEROM':7,'France':8,'UK':9,'Greece':10,'Poland':11,'Czech & Slovakia':12,'Portugal':13,'Hungary':14,'SEAD':15,'SEB':16};const REGION_TO_COORDS_MAP={'Spain':{lat:40.1213227,lon:-8.2126345},'Sweden':{lat:61.7408759,lon:8.4226912},'Denmark':{lat:56.2097048,lon:9.2950757},'Finland':{lat:64.6222352,lon:17.0720047},'Italy':{lat:41.2031887,lon:8.2129043},'Norway':{lat:64.2853881,lon:8.7594611},'SEROM':{lat:44.3937893,lon:23.84318377},'France':{lat:46.1309898,lon:-2.4457894},'UK':{lat:54.217289,lon:-13.4466842},'Greece':{lat:38.1244038,lon:22.2327838},'Poland':{lat:51.8680396,lon:14.63899},'Czech & Slovakia':{lat:49.2061586,lon:15.9140313},'Portugal':{lat:39.5601752,lon:-8.8019426},'Hungary':{lat:47.155667,lon:18.3812087},'SEAD':{lat:43.7446054,lon:16.788233},'SEB':{lat:56.7993995,lon:22.503913}};function MapScreen(){const[region,setRegion]=useState('UK');const[companies,setCompanies]=useState(null);const[loading,setLoading]=useState(false);const[searchLocation,setSearchLocation]=useState({lat:50.8742724,lon:0.6619475});const[activePlace,setActivePlace]=useState();const[filteredCompanies,setFilteredCompanies]=useState(companies);const[storeType,setStoreType]=useState('For home & business');const[productType,setProductType]=useState('Cooling & Heating');const[distanceType,setDistanceType]=useState('km');const[distance,setDistance]=useState(10);const[searchType,setSearchType]=useState('simple');const mapRef=React.createRef();const fetchGoogleSheet=async()=>{await doc.useServiceAccountAuth(require('./SEACE Installer Locator-5a80e6b026be.json'));};// const onSearch = async (query: string) => {\n//   const point = {lat: 51.5287714, lon: -0.2420237}\n//   // const point = GMaps.getLocation(query)\n// }\nconst distanceToTarget=(location,locationTarget)=>{// TODO: Replace with maps distance\nvar a=location.lat-locationTarget.lat;var b=location.lon-locationTarget.lon;return Math.sqrt(a*a+b*b);};const fetchCompaniesForRegion=async region=>{try{setLoading(true);await doc.loadInfo();const sheet=doc.sheetsByIndex[REGION_TO_SHEET_MAP[region]];const rows=await sheet.getRows();const centerCoords=REGION_TO_COORDS_MAP[region];setCompanies(rows);setSearchLocation(centerCoords);console.log(rows);setLoading(false);}catch(error){setLoading(false);console.error(error);}};// Only once\nuseEffect(()=>{fetchGoogleSheet();});// Every region change\nuseEffect(()=>{fetchCompaniesForRegion(region);},[region]);// Every filter change, or when companies load in\nuseEffect(()=>{if(companies&&searchLocation){const filterCompanies=(companies,distance,searchLocation,storeType,productType,searchType)=>{// Filter on type first for performance\nlet filteredCompanies=companies;if(searchType==='advanced'){if(storeType==='For home'||storeType==='For business'){filteredCompanies=filteredCompanies.filter(c=>c['Installer Type']===storeType||c['Installer Type']==='For home & business');}if(productType==='Cooling'||productType==='Heating'){filteredCompanies=filteredCompanies.filter(c=>c['Product Type']===productType||c['Product Type']==='Cooling & Heating');}}// Calculate distance\nfilteredCompanies=filteredCompanies.map(c=>{console.log({storeType:storeType,type:c['Installer Type']});console.log({lat:parseFloat(String(c['Latitude'])),lon:parseFloat(String(c['Longitude']))});const location={lat:parseFloat(String(c['Latitude'])),lon:parseFloat(String(c['Longitude']))};c.distanceToTarget=distanceToTarget(location,searchLocation);return c;});// Filter on distance\nreturn filteredCompanies.filter(c=>c.distanceToTarget<=distance);};setFilteredCompanies(filterCompanies(companies,distance,searchLocation,storeType,productType,searchType));}},[searchLocation,companies,storeType,productType,distance,searchType]);const MyMapComponent=withScriptjs(withGoogleMap(props=>/*#__PURE__*/React.createElement(GoogleMap,{defaultZoom:8,defaultCenter:{lat:51.8266266,lng:-2.2714084},ref:mapRef,__self:this,__source:{fileName:_jsxFileName,lineNumber:152,columnNumber:5}},filteredCompanies&&filteredCompanies.map((c,idx)=>{const productType=String(c['Product Type']).toLowerCase();const position={lat:parseFloat(String(c['Latitude'])),lng:parseFloat(String(c['Longitude']))};const installerType=String(c['Installer Type']);// Select icon based on the installer type\nlet icon;if(installerType==='For home'){icon=require('./home.svg');}else if(installerType==='For business'){icon=require('./biz.svg');}else{icon=require('./both.svg');}return/*#__PURE__*/React.createElement(Marker,{position:position,onClick:()=>{mapRef.current.panTo({lat:parseFloat(String(c['Latitude'])),lng:parseFloat(String(c['Longitude']))});setActivePlace(c['Company name']);},icon:{url:icon},label:{color:'white',fontSize:'16px',paddingBottom:'150px',text:(idx+1).toString()},__self:this,__source:{fileName:_jsxFileName,lineNumber:172,columnNumber:16}},activePlace&&activePlace===c['Company name']&&/*#__PURE__*/React.createElement(InfoWindow,{__self:this,__source:{fileName:_jsxFileName,lineNumber:183,columnNumber:13}},/*#__PURE__*/React.createElement(Fragment,{__self:this,__source:{fileName:_jsxFileName,lineNumber:184,columnNumber:15}},/*#__PURE__*/React.createElement(\"p\",{__self:this,__source:{fileName:_jsxFileName,lineNumber:185,columnNumber:17}},c['Company name']),/*#__PURE__*/React.createElement(\"p\",{__self:this,__source:{fileName:_jsxFileName,lineNumber:186,columnNumber:17}},c['Street Address']),/*#__PURE__*/React.createElement(\"p\",{__self:this,__source:{fileName:_jsxFileName,lineNumber:187,columnNumber:17}},c['City']),/*#__PURE__*/React.createElement(\"p\",{__self:this,__source:{fileName:_jsxFileName,lineNumber:188,columnNumber:17}},c['Installer Type']),/*#__PURE__*/React.createElement(\"p\",{__self:this,__source:{fileName:_jsxFileName,lineNumber:189,columnNumber:17}},c['Website']),/*#__PURE__*/React.createElement(\"p\",{__self:this,__source:{fileName:_jsxFileName,lineNumber:190,columnNumber:17}},\"Contact Name: \",c['Contact Name']),/*#__PURE__*/React.createElement(\"p\",{__self:this,__source:{fileName:_jsxFileName,lineNumber:191,columnNumber:17}},c['Email']),/*#__PURE__*/React.createElement(\"p\",{__self:this,__source:{fileName:_jsxFileName,lineNumber:192,columnNumber:17}},c['Phone number']))));}))));return/*#__PURE__*/ (/*<div className=\"map-screen\">*/ /* <iframe\n        width=\"100%\"\n        height=\"100%\"\n        style={{border:0}}\n        src=\"https://www.google.com/maps/embed/v1/place?key=API_KEY\n          &q=Space+Needle,Seattle+WA\">\n      </iframe> */ /* <GoogleMapReact\n        bootstrapURLKeys={{ key: 'gme-samsungsds' }}\n        defaultCenter={{lat: 59.95, lng: 30.33}}\n        defaultZoom={11}\n      > */React.createElement(\"div\",{__self:this,__source:{fileName:_jsxFileName,lineNumber:217,columnNumber:7}},/*#__PURE__*/React.createElement(MyMapComponent,{className:\"map-screen\",isMarkerShown:true// googleMapURL=\"https://maps.googleapis.com/maps/api/js?client=gme-samsungsds&v=3.exp&libraries=geometry,drawing,places\"\n,googleMapURL:\"https://maps.googleapis.com/maps/api/js&v=3.exp&libraries=geometry,drawing,places\",loadingElement:/*#__PURE__*/React.createElement(\"div\",{style:{height:`100%`},__self:this,__source:{fileName:_jsxFileName,lineNumber:223,columnNumber:27}}),containerElement:/*#__PURE__*/React.createElement(\"div\",{style:{height:`100vh`},__self:this,__source:{fileName:_jsxFileName,lineNumber:224,columnNumber:29}}),mapElement:/*#__PURE__*/React.createElement(\"div\",{style:{height:`100%`},__self:this,__source:{fileName:_jsxFileName,lineNumber:225,columnNumber:23}}),__self:this,__source:{fileName:_jsxFileName,lineNumber:218,columnNumber:9}}),/*#__PURE__*/React.createElement(Filter,{onSubmit:()=>{},loading:loading,companies:filteredCompanies,searchLocation:searchLocation,mapRef:mapRef,setActivePlace:setActivePlace,setDistance:setDistance,setStoreType:setStoreType,distanceType:distanceType,setDistanceType:setDistanceType,setProductType:setProductType,searchType:searchType,setSearchType:setSearchType,__self:this,__source:{fileName:_jsxFileName,lineNumber:228,columnNumber:9}}),/*#__PURE__*/React.createElement(MapLegend,{isOpened:true,__self:this,__source:{fileName:_jsxFileName,lineNumber:243,columnNumber:9}}),/*#__PURE__*/React.createElement(MapRegionIndicator,{region:region,setRegion:setRegion,__self:this,__source:{fileName:_jsxFileName,lineNumber:244,columnNumber:9}})));}export default MapScreen;","map":{"version":3,"sources":["/home/yuri/Freelance/Clients/Cheil/seace-qa/src/MapScreen.tsx"],"names":["React","useState","useEffect","Fragment","Filter","MapLegend","MapRegionIndicator","withScriptjs","withGoogleMap","GoogleMap","Marker","InfoWindow","GoogleSpreadsheet","require","doc","REGION_TO_SHEET_MAP","REGION_TO_COORDS_MAP","lat","lon","MapScreen","region","setRegion","companies","setCompanies","loading","setLoading","searchLocation","setSearchLocation","activePlace","setActivePlace","filteredCompanies","setFilteredCompanies","storeType","setStoreType","productType","setProductType","distanceType","setDistanceType","distance","setDistance","searchType","setSearchType","mapRef","createRef","fetchGoogleSheet","useServiceAccountAuth","distanceToTarget","location","locationTarget","a","b","Math","sqrt","fetchCompaniesForRegion","loadInfo","sheet","sheetsByIndex","rows","getRows","centerCoords","console","log","error","filterCompanies","filter","c","map","type","parseFloat","String","MyMapComponent","props","lng","idx","toLowerCase","position","installerType","icon","current","panTo","url","color","fontSize","paddingBottom","text","toString","height"],"mappings":"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","sourcesContent":["/// @ts-nocheck\nimport React, { useState, useEffect, Fragment } from 'react';\nimport './MapScreen.css';\nimport { Filter } from './components/MapFilter'\nimport { MapLegend } from './components/MapLegend'\nimport { MapRegionIndicator } from './components/MapRegionIndicator';\nimport { CompanyLayout, LocationLayout } from './interfaces';\nimport { withScriptjs, withGoogleMap, GoogleMap, Marker, InfoWindow } from \"react-google-maps\"\nimport {ReactComponent as Home} from './home.svg';\nimport {ReactComponent as Biz} from './biz.svg';\nimport {ReactComponent as Both} from './both.svg';\nimport { renderToStaticMarkup } from 'react-dom/server';\n\nconst { GoogleSpreadsheet } = require('google-spreadsheet');\n \nconst doc = new GoogleSpreadsheet('1QtCGUCN-_xZPLYExN3btHeXphRi4VI-uGABA87cHj-M');\n\nconst REGION_TO_SHEET_MAP = {\n  'Spain': 1,\n  'Sweden': 2,\n  'Denmark': 3,\n  'Finland': 4,\n  'Italy': 5,\n  'Norway': 6,\n  'SEROM': 7,\n  'France': 8,\n  'UK': 9,\n  'Greece': 10,\n  'Poland': 11,\n  'Czech & Slovakia': 12,\n  'Portugal': 13,\n  'Hungary': 14,\n  'SEAD': 15,\n  'SEB': 16\n}\n\nconst REGION_TO_COORDS_MAP = {\n  'Spain': {lat: 40.1213227, lon: -8.2126345},\n  'Sweden': {lat: 61.7408759, lon: 8.4226912},\n  'Denmark': {lat: 56.2097048, lon: 9.2950757},\n  'Finland': {lat: 64.6222352, lon: 17.0720047},\n  'Italy': {lat: 41.2031887, lon: 8.2129043},\n  'Norway': {lat: 64.2853881, lon: 8.7594611},\n  'SEROM': {lat: 44.3937893, lon: 23.84318377},\n  'France': {lat: 46.1309898, lon: -2.4457894},\n  'UK': {lat: 54.217289, lon: -13.4466842},\n  'Greece': {lat: 38.1244038, lon: 22.2327838},\n  'Poland': {lat: 51.8680396, lon:14.63899},\n  'Czech & Slovakia': {lat: 49.2061586, lon: 15.9140313},\n  'Portugal': {lat: 39.5601752, lon: -8.8019426},\n  'Hungary': {lat: 47.155667, lon: 18.3812087},\n  'SEAD': {lat: 43.7446054, lon: 16.788233},\n  'SEB': {lat: 56.7993995, lon: 22.503913}\n}\n\nfunction MapScreen() {\n  const [region, setRegion] = useState<string>('UK');\n  const [companies, setCompanies] = useState<Array<CompanyLayout> | null>(null);\n  const [loading, setLoading] = useState<boolean>(false);\n  const [searchLocation, setSearchLocation] = useState<LocationLayout | null>({lat: 50.8742724, lon: 0.6619475})\n  const [activePlace, setActivePlace] = useState<string | null>();\n  const [filteredCompanies, setFilteredCompanies] = useState(companies);\n  const [storeType, setStoreType] = useState<string>('For home & business')\n  const [productType, setProductType] = useState<string>('Cooling & Heating');\n  const [distanceType, setDistanceType] = useState<string>('km');\n  const [distance, setDistance] = useState<number>(10);\n  const [searchType, setSearchType] = useState<'simple' | 'advanced'>('simple');\n\n  const mapRef = React.createRef<React.RefObject<GoogleMap>>();\n  const fetchGoogleSheet = async () => {\n    await doc.useServiceAccountAuth(require('./SEACE Installer Locator-5a80e6b026be.json'));\n  }\n\n  // const onSearch = async (query: string) => {\n  //   const point = {lat: 51.5287714, lon: -0.2420237}\n  //   // const point = GMaps.getLocation(query)\n  // }\n\n  const distanceToTarget = (location: LocationLayout, locationTarget: LocationLayout) => {\n    // TODO: Replace with maps distance\n    var a = location.lat - locationTarget.lat;\n    var b = location.lon - locationTarget.lon;    \n    return Math.sqrt( a*a + b*b );\n  };\n\n  const fetchCompaniesForRegion = async (region: string) => {\n    try {\n      setLoading(true);\n      await doc.loadInfo();\n      const sheet = doc.sheetsByIndex[REGION_TO_SHEET_MAP[region]]\n      const rows = await sheet.getRows();\n      const centerCoords = REGION_TO_COORDS_MAP[region]\n      setCompanies(rows);\n      setSearchLocation(centerCoords);\n      \n      console.log(rows);\n      \n      setLoading(false);\n    } catch (error) {\n      setLoading(false);\n      console.error(error);\n    }\n  }\n\n  // Only once\n  useEffect(() => {fetchGoogleSheet()});\n\n  // Every region change\n  useEffect(() => {\n    fetchCompaniesForRegion(region);\n  }, [region]);\n\n  // Every filter change, or when companies load in\n  useEffect(() => {\n    if (companies && searchLocation) {\n\n      const filterCompanies = (companies: Array<CompanyLayout>, distance: number, searchLocation: LocationLayout, storeType: string, productType: string, searchType: string): Array<CompanyLayout> => {\n        // Filter on type first for performance\n        let filteredCompanies = companies\n        if (searchType === 'advanced') {\n            if (storeType === 'For home' || storeType === 'For business') {\n                filteredCompanies =  filteredCompanies.filter(c => c['Installer Type'] === storeType || c['Installer Type'] === 'For home & business');\n            }\n            if (productType === 'Cooling' || productType === 'Heating') {\n                filteredCompanies =  filteredCompanies.filter(c => c['Product Type'] === productType || c['Product Type'] === 'Cooling & Heating');\n            }\n        }\n\n        // Calculate distance\n        filteredCompanies = filteredCompanies.map(c => {\n            console.log({storeType: storeType, type: c['Installer Type']});\n            console.log({lat: parseFloat(String(c['Latitude'])), lon: parseFloat(String(c['Longitude']))});\n            \n            const location = {\n                lat: parseFloat(String(c['Latitude'])),\n                lon: parseFloat(String(c['Longitude']))\n            }\n            c.distanceToTarget = distanceToTarget(location, searchLocation);\n            return c;\n        })\n\n        // Filter on distance\n\n        return filteredCompanies.filter(c => c.distanceToTarget <= distance);\n      }\n\n      setFilteredCompanies(filterCompanies(companies, distance, searchLocation, storeType, productType, searchType));\n    }\n}, [searchLocation, companies, storeType, productType, distance, searchType]);\n\n  const MyMapComponent = withScriptjs(withGoogleMap((props) =>\n    <GoogleMap\n      defaultZoom={8}\n      defaultCenter={{ lat: 51.8266266, lng: -2.2714084 }}\n      ref={mapRef}\n    >\n      {filteredCompanies && filteredCompanies.map((c, idx) => {\n        const productType = String(c['Product Type']).toLowerCase();\n        const position = { lat: parseFloat(String(c['Latitude'])), lng: parseFloat(String(c['Longitude'])) };\n        const installerType = String(c['Installer Type'])\n       \n        // Select icon based on the installer type\n        let icon;\n        if (installerType === 'For home') {\n          icon = require('./home.svg')\n        } else if (installerType === 'For business') {\n          icon = require('./biz.svg')\n        } else {\n          icon = require('./both.svg')\n        }\n\n        return <Marker \n          position={position} \n          onClick={() =>{\n            mapRef.current.panTo({ lat: parseFloat(String(c['Latitude'])), lng: parseFloat(String(c['Longitude'])) });\n            setActivePlace(c['Company name']);\n          }}\n          icon={{url: icon}}\n          label={{color: 'white', fontSize: '16px', paddingBottom: '150px', text: (idx+1).toString() }}\n        >\n          {/* If this place is active, show the popup with the place information */}\n          {activePlace && activePlace === c['Company name'] &&\n            <InfoWindow>\n              <Fragment>\n                <p>{c['Company name']}</p>\n                <p>{c['Street Address']}</p>\n                <p>{c['City']}</p>\n                <p>{c['Installer Type']}</p>\n                <p>{c['Website']}</p>\n                <p>Contact Name: {c['Contact Name']}</p>\n                <p>{c['Email']}</p>\n                <p>{c['Phone number']}</p>\n              </Fragment>\n            </InfoWindow>\n          }\n          \n        </Marker>\n      })}\n      {/* <Marker position={{ lat: 51.8266266, lng: 150.644 }} /> */}\n    </GoogleMap>\n  ))\n\n  return (\n    /*<div className=\"map-screen\">*/\n      /* <iframe\n        width=\"100%\"\n        height=\"100%\"\n        style={{border:0}}\n        src=\"https://www.google.com/maps/embed/v1/place?key=API_KEY\n          &q=Space+Needle,Seattle+WA\">\n      </iframe> */\n      /* <GoogleMapReact\n        bootstrapURLKeys={{ key: 'gme-samsungsds' }}\n        defaultCenter={{lat: 59.95, lng: 30.33}}\n        defaultZoom={11}\n      > */\n      <div>\n        <MyMapComponent\n          className=\"map-screen\"\n          isMarkerShown={true}\n          // googleMapURL=\"https://maps.googleapis.com/maps/api/js?client=gme-samsungsds&v=3.exp&libraries=geometry,drawing,places\"\n          googleMapURL=\"https://maps.googleapis.com/maps/api/js&v=3.exp&libraries=geometry,drawing,places\"\n          loadingElement={<div style={{ height: `100%` }} />}\n          containerElement={<div style={{ height: `100vh` }} />}\n          mapElement={<div style={{ height: `100%` }} />}\n        >\n        </MyMapComponent>\n        <Filter\n          onSubmit={() => {}}\n          loading={loading}\n          companies={filteredCompanies}\n          searchLocation={searchLocation}\n          mapRef={mapRef}\n          setActivePlace={setActivePlace}\n          setDistance={setDistance}\n          setStoreType={setStoreType}\n          distanceType={distanceType}\n          setDistanceType={setDistanceType}\n          setProductType={setProductType}\n          searchType={searchType}\n          setSearchType={setSearchType}\n        />\n        <MapLegend isOpened={true}/>\n        <MapRegionIndicator region={region} setRegion={setRegion}/>\n      </div>\n  );\n}\n\nexport default MapScreen;"]},"metadata":{},"sourceType":"module"}